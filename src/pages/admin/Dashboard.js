var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useEffect, useState, useRef } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Button } from "@/components/ui/button";
import { Link } from "react-router-dom";
import { BarChart3, Users, MessageSquare, CreditCard, Circle, ArrowUpRight, ArrowDownRight, FileText, Bell, Settings, } from "lucide-react";
import { PageHeader } from "@/components/layout/PageHeader";
import { DashboardSection } from "@/components/layout/DashboardSection";
import { useAuth } from "@/contexts/UnifiedAuthContext";
import withAdminInit from "@/components/admin/withAdminInit";
import { runDashboardHealthCheck, fixCommonDashboardIssues } from '@/lib/dashboard-health';
// TODO: Remove this when admin dashboard issues are fixed
const DEBUG_ADMIN = true;
const DebugAdminDashboard = () => {
    const { user, isLoading, isAdmin, profile, refreshAuthState } = useAuth();
    const [healthResults, setHealthResults] = useState(null);
    const [isRunningHealthCheck, setIsRunningHealthCheck] = useState(false);
    const timestamp = () => new Date().toISOString();
    const renderTime = useRef(timestamp());
    useEffect(() => {
        console.log(`[DebugAdminDashboard] Rendered at ${renderTime.current}`);
        console.log(`[DebugAdminDashboard] Auth state:`, {
            isLoading,
            hasUser: !!user,
            isAdmin,
            email: user === null || user === void 0 ? void 0 : user.email
        });
    }, [isLoading, user, isAdmin]);
    const runHealthCheck = () => __awaiter(void 0, void 0, void 0, function* () {
        setIsRunningHealthCheck(true);
        try {
            const results = yield runDashboardHealthCheck();
            setHealthResults(results);
        }
        catch (error) {
            console.error("[DebugAdminDashboard] Health check error:", error);
            setHealthResults({ error: String(error) });
        }
        finally {
            setIsRunningHealthCheck(false);
        }
    });
    const applyFixes = () => {
        try {
            fixCommonDashboardIssues();
            setTimeout(() => {
                runHealthCheck();
                if (refreshAuthState) {
                    refreshAuthState();
                }
            }, 500);
        }
        catch (error) {
            console.error("[DebugAdminDashboard] Fix error:", error);
        }
    };
    const forceAdminStatus = () => {
        localStorage.setItem('akii-is-admin', 'true');
        localStorage.setItem('akii-auth-emergency', 'true');
        localStorage.setItem('akii-auth-emergency-time', Date.now().toString());
        if (refreshAuthState) {
            refreshAuthState();
        }
    };
    return (_jsxs("div", { className: "p-4 max-w-4xl mx-auto", children: [_jsx("h1", { className: "text-2xl font-bold mb-4", children: "Admin Dashboard Debug" }), _jsxs("div", { className: "bg-card border-border border rounded p-4 mb-4 dark:bg-card", children: [_jsx("h2", { className: "text-lg font-semibold mb-2", children: "Debug Information" }), _jsxs("div", { className: "mb-2", children: [_jsxs("p", { children: [_jsx("strong", { children: "Render time:" }), " ", renderTime.current] }), _jsxs("p", { children: [_jsx("strong", { children: "Current time:" }), " ", timestamp()] })] })] }), _jsxs("div", { className: "bg-card border-border border rounded p-4 mb-4 dark:bg-card", children: [_jsx("h2", { className: "text-lg font-semibold mb-2", children: "Authentication State" }), _jsxs("div", { className: "mb-2", children: [_jsxs("p", { children: [_jsx("strong", { children: "Loading:" }), " ", isLoading ? '⏳' : '✅'] }), _jsxs("p", { children: [_jsx("strong", { children: "User:" }), " ", user ? user.email : 'Not signed in'] }), _jsxs("p", { children: [_jsx("strong", { children: "Admin:" }), " ", isAdmin ? '✅' : '❌'] }), _jsxs("p", { children: [_jsx("strong", { children: "Profile:" }), " ", profile ? '✅' : '❌'] })] })] }), _jsxs("div", { className: "bg-card border-primary/20 border rounded p-4 mb-4 dark:bg-card", children: [_jsx("h2", { className: "text-lg font-semibold mb-2", children: "Dashboard Health" }), _jsxs("div", { className: "flex space-x-2 mb-4", children: [_jsx("button", { onClick: runHealthCheck, disabled: isRunningHealthCheck, className: "px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:bg-primary/50", children: isRunningHealthCheck ? 'Running Check...' : 'Run Health Check' }), _jsx("button", { onClick: applyFixes, className: "px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 dark:bg-green-800 dark:hover:bg-green-700", children: "Fix Common Issues" })] }), healthResults && (_jsx("div", { className: "bg-background border-border border rounded p-3 mb-3 max-h-60 overflow-auto", children: _jsx("pre", { className: "text-xs", children: JSON.stringify(healthResults, null, 2) }) }))] }), _jsxs("div", { className: "bg-card border-purple-500/20 border rounded p-4 mb-4 dark:bg-card", children: [_jsx("h2", { className: "text-lg font-semibold mb-2", children: "Admin Actions" }), _jsxs("div", { className: "flex space-x-2", children: [_jsx("button", { onClick: forceAdminStatus, className: "px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 dark:bg-purple-800 dark:hover:bg-purple-700", children: "Force Admin Status" }), _jsx("button", { onClick: () => refreshAuthState && refreshAuthState(), className: "px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 dark:bg-indigo-800 dark:hover:bg-indigo-700", children: "Refresh Auth State" })] })] }), _jsxs("div", { className: "bg-card border-red-500/20 border rounded p-4 dark:bg-card", children: [_jsx("h2", { className: "text-lg font-semibold mb-2", children: "Actions" }), _jsx("button", { onClick: () => window.location.reload(), className: "px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 dark:bg-red-800 dark:hover:bg-red-700", children: "Reload Page" })] })] }));
};
const AdminDashboard = () => {
    const { user, isAdmin } = useAuth();
    console.log("[AdminDashboard] Component rendering start");
    // Log auth state for debugging
    useEffect(() => {
        console.log("[AdminDashboard] Auth state:", {
            user: user === null || user === void 0 ? void 0 : user.email,
            isAdmin,
            localStorage: {
                isAdmin: localStorage.getItem('akii-is-admin') === 'true',
                userEmail: localStorage.getItem('akii-auth-user-email')
            }
        });
    }, [user, isAdmin]);
    // Use debug admin dashboard when enabled
    if (DEBUG_ADMIN) {
        return _jsx(DebugAdminDashboard, {});
    }
    return (_jsxs("div", { className: "space-y-6", children: [_jsxs(PageHeader, { title: "Admin Dashboard", description: "Monitor platform performance and manage system settings", children: [_jsx(Button, { asChild: true, children: _jsx(Link, { to: "/admin/run-migration", children: "Database Migrations" }) }), _jsxs("div", { className: "text-sm text-muted-foreground", children: ["Project ID: ", _jsx("span", { className: "font-mono", children: "injxxchotrvgvvzelhvj" })] })] }), _jsx(DashboardSection, { children: _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4", children: [_jsx(Card, { children: _jsxs(CardContent, { className: "p-6", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-muted-foreground", children: "Total Users" }), _jsx("h3", { className: "text-2xl font-bold mt-1", children: "2,543" })] }), _jsx("div", { className: "h-12 w-12 bg-primary/10 rounded-full flex items-center justify-center", children: _jsx(Users, { className: "h-6 w-6 text-primary" }) })] }), _jsxs("div", { className: "flex items-center mt-4 text-sm", children: [_jsx(ArrowUpRight, { className: "h-4 w-4 text-green-500 mr-1" }), _jsx("span", { className: "text-green-500 font-medium", children: "12%" }), _jsx("span", { className: "text-muted-foreground ml-1", children: "from last month" })] })] }) }), _jsx(Card, { children: _jsxs(CardContent, { className: "p-6", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-muted-foreground", children: "Active Agents" }), _jsx("h3", { className: "text-2xl font-bold mt-1", children: "1,247" })] }), _jsx("div", { className: "h-12 w-12 bg-primary/10 rounded-full flex items-center justify-center", children: _jsx(Circle, { className: "h-6 w-6 text-primary" }) })] }), _jsxs("div", { className: "flex items-center mt-4 text-sm", children: [_jsx(ArrowUpRight, { className: "h-4 w-4 text-green-500 mr-1" }), _jsx("span", { className: "text-green-500 font-medium", children: "8%" }), _jsx("span", { className: "text-muted-foreground ml-1", children: "from last month" })] })] }) }), _jsx(Card, { children: _jsxs(CardContent, { className: "p-6", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-muted-foreground", children: "Total Messages" }), _jsx("h3", { className: "text-2xl font-bold mt-1", children: "3.2M" })] }), _jsx("div", { className: "h-12 w-12 bg-primary/10 rounded-full flex items-center justify-center", children: _jsx(MessageSquare, { className: "h-6 w-6 text-primary" }) })] }), _jsxs("div", { className: "flex items-center mt-4 text-sm", children: [_jsx(ArrowUpRight, { className: "h-4 w-4 text-green-500 mr-1" }), _jsx("span", { className: "text-green-500 font-medium", children: "24%" }), _jsx("span", { className: "text-muted-foreground ml-1", children: "from last month" })] })] }) }), _jsx(Card, { children: _jsxs(CardContent, { className: "p-6", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-muted-foreground", children: "Monthly Revenue" }), _jsx("h3", { className: "text-2xl font-bold mt-1", children: "$48,254" })] }), _jsx("div", { className: "h-12 w-12 bg-primary/10 rounded-full flex items-center justify-center", children: _jsx(CreditCard, { className: "h-6 w-6 text-primary" }) })] }), _jsxs("div", { className: "flex items-center mt-4 text-sm", children: [_jsx(ArrowDownRight, { className: "h-4 w-4 text-red-500 mr-1" }), _jsx("span", { className: "text-red-500 font-medium", children: "3%" }), _jsx("span", { className: "text-muted-foreground ml-1", children: "from last month" })] })] }) })] }) }), _jsxs(Tabs, { defaultValue: "overview", children: [_jsxs(TabsList, { className: "grid w-full grid-cols-5 mb-4", children: [_jsx(TabsTrigger, { value: "overview", children: "Overview" }), _jsx(TabsTrigger, { value: "users", children: "Users" }), _jsx(TabsTrigger, { value: "agents", children: "Agents" }), _jsx(TabsTrigger, { value: "revenue", children: "Revenue" }), _jsx(TabsTrigger, { value: "moderation", children: "Moderation" })] }), _jsxs(TabsContent, { value: "overview", className: "space-y-4", children: [_jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-4", children: [_jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "User Growth" }) }), _jsx(CardContent, { children: _jsx("div", { className: "h-80 flex items-center justify-center bg-muted/20 rounded-md", children: _jsx("p", { className: "text-muted-foreground", children: "User Growth Chart" }) }) })] }), _jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Message Volume" }) }), _jsx(CardContent, { children: _jsx("div", { className: "h-80 flex items-center justify-center bg-muted/20 rounded-md", children: _jsx("p", { className: "text-muted-foreground", children: "Message Volume Chart" }) }) })] })] }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-4", children: [_jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Recent Alerts" }) }), _jsx(CardContent, { children: _jsxs("div", { className: "space-y-4", children: [_jsxs("div", { className: "flex items-start gap-3 pb-3 border-b", children: [_jsx("div", { className: "h-8 w-8 bg-amber-100 rounded-full flex items-center justify-center", children: _jsx(Bell, { className: "h-4 w-4 text-amber-600" }) }), _jsxs("div", { children: [_jsx("p", { className: "font-medium", children: "High Error Rate" }), _jsx("p", { className: "text-sm text-muted-foreground", children: "Error rate exceeded 5% threshold on Agent #1247" }), _jsx("p", { className: "text-xs text-muted-foreground mt-1", children: "2 hours ago" })] })] }), _jsxs("div", { className: "flex items-start gap-3 pb-3 border-b", children: [_jsx("div", { className: "h-8 w-8 bg-red-100 rounded-full flex items-center justify-center", children: _jsx(Bell, { className: "h-4 w-4 text-red-600" }) }), _jsxs("div", { children: [_jsx("p", { className: "font-medium", children: "Moderation Alert" }), _jsx("p", { className: "text-sm text-muted-foreground", children: "Content flagged for review in conversation #8721" }), _jsx("p", { className: "text-xs text-muted-foreground mt-1", children: "4 hours ago" })] })] }), _jsxs("div", { className: "flex items-start gap-3", children: [_jsx("div", { className: "h-8 w-8 bg-green-100 rounded-full flex items-center justify-center", children: _jsx(Bell, { className: "h-4 w-4 text-green-600" }) }), _jsxs("div", { children: [_jsx("p", { className: "font-medium", children: "System Update" }), _jsx("p", { className: "text-sm text-muted-foreground", children: "AI model updated to version 2.4.1" }), _jsx("p", { className: "text-xs text-muted-foreground mt-1", children: "Yesterday" })] })] })] }) })] }), _jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Top Performing Agents" }) }), _jsx(CardContent, { children: _jsxs("div", { className: "space-y-4", children: [_jsxs("div", { className: "flex items-center justify-between pb-2 border-b", children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: "h-8 w-8 bg-blue-100 rounded-full flex items-center justify-center", children: _jsx(Circle, { className: "h-4 w-4 text-blue-600" }) }), _jsxs("div", { children: [_jsx("p", { className: "font-medium", children: "Sales Assistant" }), _jsx("p", { className: "text-xs text-muted-foreground", children: "E-commerce" })] })] }), _jsxs("div", { className: "text-right", children: [_jsx("p", { className: "font-medium", children: "98%" }), _jsx("p", { className: "text-xs text-muted-foreground", children: "Satisfaction" })] })] }), _jsxs("div", { className: "flex items-center justify-between pb-2 border-b", children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: "h-8 w-8 bg-purple-100 rounded-full flex items-center justify-center", children: _jsx(Circle, { className: "h-4 w-4 text-purple-600" }) }), _jsxs("div", { children: [_jsx("p", { className: "font-medium", children: "Support Bot" }), _jsx("p", { className: "text-xs text-muted-foreground", children: "SaaS" })] })] }), _jsxs("div", { className: "text-right", children: [_jsx("p", { className: "font-medium", children: "95%" }), _jsx("p", { className: "text-xs text-muted-foreground", children: "Satisfaction" })] })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: "h-8 w-8 bg-green-100 rounded-full flex items-center justify-center", children: _jsx(Circle, { className: "h-4 w-4 text-green-600" }) }), _jsxs("div", { children: [_jsx("p", { className: "font-medium", children: "Product Advisor" }), _jsx("p", { className: "text-xs text-muted-foreground", children: "Retail" })] })] }), _jsxs("div", { className: "text-right", children: [_jsx("p", { className: "font-medium", children: "92%" }), _jsx("p", { className: "text-xs text-muted-foreground", children: "Satisfaction" })] })] })] }) })] }), _jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Quick Actions" }) }), _jsx(CardContent, { children: _jsxs("div", { className: "grid grid-cols-2 gap-2", children: [_jsxs(Button, { variant: "outline", className: "h-auto py-4 flex flex-col items-center justify-center", children: [_jsx(Users, { className: "h-5 w-5 mb-1" }), _jsx("span", { children: "Manage Users" })] }), _jsxs(Button, { variant: "outline", className: "h-auto py-4 flex flex-col items-center justify-center", children: [_jsx(Settings, { className: "h-5 w-5 mb-1" }), _jsx("span", { children: "System Settings" })] }), _jsx(Button, { variant: "outline", className: "h-auto py-4 flex flex-col items-center justify-center", asChild: true, children: _jsxs(Link, { to: "/admin/run-migration", children: [_jsx(FileText, { className: "h-5 w-5 mb-1" }), _jsx("span", { children: "Database Migrations" })] }) }), _jsxs(Button, { variant: "outline", className: "h-auto py-4 flex flex-col items-center justify-center", children: [_jsx(BarChart3, { className: "h-5 w-5 mb-1" }), _jsx("span", { children: "View Reports" })] })] }) })] })] })] }), _jsx(TabsContent, { value: "users", children: _jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "User Analytics" }) }), _jsx(CardContent, { children: _jsx("div", { className: "h-96 flex items-center justify-center bg-muted/20 rounded-md", children: _jsx("p", { className: "text-muted-foreground", children: "User Analytics Dashboard" }) }) })] }) }), _jsx(TabsContent, { value: "agents", children: _jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Agent Performance" }) }), _jsx(CardContent, { children: _jsx("div", { className: "h-96 flex items-center justify-center bg-muted/20 rounded-md", children: _jsx("p", { className: "text-muted-foreground", children: "Agent Performance Dashboard" }) }) })] }) }), _jsx(TabsContent, { value: "revenue", children: _jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Revenue Analytics" }) }), _jsx(CardContent, { children: _jsx("div", { className: "h-96 flex items-center justify-center bg-muted/20 rounded-md", children: _jsx("p", { className: "text-muted-foreground", children: "Revenue Analytics Dashboard" }) }) })] }) }), _jsx(TabsContent, { value: "moderation", children: _jsxs(Card, { children: [_jsx(CardHeader, { children: _jsx(CardTitle, { children: "Content Moderation" }) }), _jsx(CardContent, { children: _jsx("div", { className: "h-96 flex items-center justify-center bg-muted/20 rounded-md", children: _jsx("p", { className: "text-muted-foreground", children: "Content Moderation Dashboard" }) }) })] }) })] })] }));
};
// Use the HOC to enhance the component with admin initialization and error handling
export default withAdminInit(AdminDashboard);
